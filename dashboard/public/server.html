<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-locale-key="dashboard_server_page_title">Gerenciar Servidor</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="main-container">
    <aside class="sidebar">
      <div class="sidebar-header"><h1 id="bot-name" data-locale-key="dashboard_loading"></h1></div>
      <nav class="sidebar-nav" id="server-nav-links"></nav>
    </aside>

    <main class="dashboard-grid">
      <div class="widget">
        <h2 id="server-name-title" data-locale-key="dashboard_loading_server"></h2>
      </div>

      <div id="panel-ai" class="settings-panel">
        <div id="panel-ai-container">
          <div class="widget">
            <h2 data-locale-key="dashboard_server_ai_settings"></h2>
            <div class="sub-widget">
              <h3 data-locale-key="dashboard_server_ai_channels"></h3>
              <div id="channels-list" class="channels-list"></div>
            </div>
            <div class="sub-widget">
              <h3 data-locale-key="dashboard_server_chatbot_settings"></h3>
              <form id="chatbot-settings-form" class="profile-form">

                <div class="form-group">
                  <label for="ai-context-limit" data-locale-key="dashboard_server_ai_context_limit_label">Context Limit</label>
                  <input type="number" id="ai-context-limit" class="form-number" min="1" max="50" value="15">
                  <small style="color:var(--muted); font-size:0.8rem;" data-locale-key="dashboard_server_ai_context_limit_desc"># of messages the bot remembers. (1-50)</small>
                </div>

                <div class="form-group">
                  <label data-locale-key="dashboard_server_ai_personality_label">Personality</label>
                  <div id="ai-personality-container">
                    <!-- Dynamic textareas for personality will be inserted here -->
                  </div>
                  <button type="button" id="add-personality-btn" class="form-button-sm" data-locale-key="dashboard_server_add_button">+</button>
                </div>
                <div class="form-group">
                  <label data-locale-key="dashboard_server_ai_examples_label">Examples</label>
                  <div id="ai-examples-container">
                    <!-- Dynamic textareas for examples will be inserted here -->
                  </div>
                  <button type="button" id="add-example-btn" class="form-button-sm" data-locale-key="dashboard_server_add_button">+</button>
                </div>
                <div class="sub-widget">
                  <h3 data-locale-key="dashboard_server_ai_tool_permissions">AI Tool Permissions</h3>
                  <div id="ai-tools-list" class="tools-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <!-- Checkboxes will be inserted here by server.js -->
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="widget">
            <div class="chat-tester">
              <div class="chat-tester-header">
                <h2 data-locale-key="dashboard_server_ai_tester_title"></h2>
                <button id="clear-chat-btn" data-locale-key="dashboard_server_ai_tester_clear_button"></button>
              </div>
              <div id="chat-display" class="chat-tester-display"></div>
              <div class="chat-tester-input">
                <input type="text" id="chat-input" class="form-input" data-locale-placeholder-key="dashboard_server_ai_tester_input_placeholder">
                <button id="send-chat-btn" class="form-button" data-locale-key="dashboard_server_ai_tester_send_button"></button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="panel-music" class="widget settings-panel" style="display: none;">
        <h2 data-locale-key="dashboard_server_music_title">Music</h2>
        <div id="music-container" style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
            <div id="music-player-widget">
                <div class="sub-widget" id="now-playing-card">
                    <h3 data-locale-key="dashboard_server_music_now_playing">Now Playing</h3>
                    <p id="np-song-title" data-locale-key="dashboard_server_music_nothing_playing">Nothing playing right now</p>
                    <div id="np-controls" style="display: flex; gap: 10px; margin-top: 10px;">
                        <button id="music-pause-btn" class="form-button">⏸</button>
                        <button id="music-resume-btn" class="form-button">▶️</button>
                        <button id="music-skip-btn" class="form-button">⏭️</button>
                    </div>
                </div>
                 <div class="sub-widget" id="music-settings-card" style="margin-top: 20px;">
                    <h3 data-locale-key="dashboard_server_music_settings">Settings</h3>
                    <div class="form-group">
                        <label for="music-dj-role" data-locale-key="dashboard_server_music_dj_role">DJ Role</label>
                        <input type="text" id="music-dj-role" class="form-input" data-locale-placeholder-key="dashboard_server_music_dj_role_placeholder">
                    </div>
                </div>
            </div>
            <div class="sub-widget" id="music-queue-widget">
                <h3 data-locale-key="dashboard_server_music_queue">Queue</h3>
                <div id="queue-list" style="max-height: 400px; overflow-y: auto;">
                    <p data-locale-key="dashboard_server_music_queue_empty">The queue is empty.</p>
                </div>
            </div>
        </div>
      </div>

      <div id="panel-faq" class="widget settings-panel" style="display: none;">
        <h2 data-locale-key="dashboard_server_faq_settings"></h2>
        <div id="faq-list" class="faq-list"></div>
        <div class="profile-form">
          <input type="text" id="faq-new-question" class="form-input" data-locale-placeholder-key="dashboard_server_faq_new_question_placeholder">
          <textarea id="faq-new-answer" class="form-textarea" data-locale-placeholder-key="dashboard_server_faq_new_answer_placeholder"></textarea>
          <button id="faq-add-btn" class="form-button" data-locale-key="dashboard_server_faq_add_button"></button>
        </div>
      </div>

      <div id="panel-knowledge" class="widget settings-panel" style="display: none;">
        <h2 data-locale-key="dashboard_server_knowledge_settings">Knowledge Base</h2>
        <div id="knowledge-list" class="faq-list"></div>
        <div class="profile-form">
          <input type="text" id="knowledge-new-question" class="form-input" data-locale-placeholder-key="dashboard_server_knowledge_new_question_placeholder">
          <textarea id="knowledge-new-answer" class="form-textarea" data-locale-placeholder-key="dashboard_server_knowledge_new_answer_placeholder"></textarea>
          <button id="knowledge-add-btn" class="form-button" data-locale-key="dashboard_server_knowledge_add_button"></button>
        </div>
      </div>

      <div id="panel-github" class="settings-panel" style="display: none;">
        <div class="widget">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 data-locale-key="dashboard_server_github_title">GitHub Monitoring</h2>
                <button id="add-repo-btn" class="form-button" data-locale-key="dashboard_server_github_add_repo_button">Add Repository</button>
            </div>
            <div id="repo-list">
                <!-- Repository cards will be inserted here by JavaScript -->
            </div>
        </div>
      </div>

      <div class="widget">
        <button id="save-settings-btn" class="form-button" data-locale-key="dashboard_server_save_button"></button>
        <p id="save-status" class="status-message"></p>
      </div>
    </main>

    <div id="repo-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="modal-title" data-locale-key="dashboard_server_github_modal_add_title">Add New Repository</h3>
            <form id="repo-form" class="profile-form">
                <input type="hidden" id="repo-id">

                <div class="form-group">
                    <label for="repo-url" data-locale-key="dashboard_server_github_modal_repo_url_label">GitHub Repository URL</label>
                    <input type="text" id="repo-url" class="form-input" placeholder="https://github.com/user/repo" required>
                </div>

                <div class="form-group">
                    <label for="repo-secret" data-locale-key="dashboard_server_github_modal_repo_secret_label">Webhook Secret</label>
                    <input type="text" id="repo-secret" class="form-input" data-locale-placeholder-key="dashboard_server_github_modal_repo_secret_placeholder">
                    <small style="color:var(--muted); font-size:0.8rem;" data-locale-key="dashboard_server_github_modal_repo_secret_desc">This must match the secret in your GitHub webhook settings.</small>
                </div>

                <div id="modal-config-sections">
                    <!-- Config sections are built by JS -->
                </div>

                <div class="modal-actions">
                    <button type="button" id="delete-repo-btn" class="form-button danger-btn" style="display: none;" data-locale-key="dashboard_server_github_modal_delete_button">Delete</button>
                    <button type="submit" class="form-button" data-locale-key="dashboard_server_github_modal_save_button">Save</button>
                    <button type="button" id="cancel-modal-btn" class="form-button" style="background-color: var(--muted);" data-locale-key="dashboard_server_github_modal_cancel_button">Cancel</button>
                </div>
            </form>
        </div>
    </div>
  </div>
  <script src="auth.js"></script>
  <script src="translator.js"></script>
  <script src="server.js"></script>
</body>
</html>
